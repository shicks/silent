"use strict";(()=>{var E=document.getElementById("out"),L=document.getElementById("values"),y=document.getElementById("sensitivity"),f=document.getElementById("volume");function d(){r=Number(f.value)/100,o=4*2**(Number(y.value)/100*12),console.log(`knobs: ${r} ${o}`)}"wakeLock"in navigator&&navigator.wakeLock.request("screen");var r=0,o=1024;y.addEventListener("change",d);f.addEventListener("change",d);d();function M(b){let e=new AudioContext,h=e.createMediaStreamSource(b),t=e.createAnalyser(),a=e.createOscillator();a.type="sawtooth";let q=t.frequencyBinCount/24*e.sampleRate/t.fftSize;a.frequency.value=q;let s=0,n=e.createGain();n.connect(e.destination),n.gain.value=0,h.connect(t),a.connect(n),a.start(0);let m=new Uint8Array(t.frequencyBinCount),u=0,c=0;function v(){console.log("play"),s++,t.getByteFrequencyData(m);let l=0;for(let i=0;i<t.frequencyBinCount;i++)l+=m[i];u=Math.max(l,u*.97);let g=l>c?.05:.02;c=c*(1-g)+l*g;let B=`hsl(${Math.max(0,(3*o-c)/(3*o)*120)}deg 100% 50%)`;E.style.background=B,u>o?n.gain.value=s/30&1?0:r:n.gain.value=s=0,requestAnimationFrame(v)}v()}navigator.getUserMedia({video:!1,audio:!0},M,console.log);})();
